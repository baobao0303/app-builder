<div class="app-container" (click)="onContainerClick($event)">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <button type="button" (click)="undo()" title="Undo" class="icon-button">â†¶</button>
      <button type="button" (click)="redo()" title="Redo" class="icon-button">â†·</button>
      <div class="zoom-controls">
        <div class="zoom-dropdown">
          <button type="button" class="zoom-button" (click)="toggleZoomMenu()" title="Zoom">
            <span class="zoom-icon">ğŸ”</span>
            <span>{{ zoomLevel() }}%</span>
            <span class="zoom-caret">â–¼</span>
          </button>
          @if (showZoomMenu()) {
          <div class="zoom-menu" (click)="$event.stopPropagation()">
            <button
              type="button"
              class="zoom-menu-item"
              (click)="setZoom(100)"
              [class.active]="zoomLevel() === 100"
            >
              Actual size
            </button>
            <button type="button" class="zoom-menu-item" (click)="zoomToFit()">Zoom to fit</button>
            <button type="button" class="zoom-menu-item" (click)="zoomIn()">
              Zoom in
              <span class="shortcut">Ctrl +</span>
            </button>
            <button type="button" class="zoom-menu-item" (click)="zoomOut()">
              Zoom out
              <span class="shortcut">Ctrl -</span>
            </button>
            <div class="zoom-divider"></div>
            @for (level of zoomLevels; track level) {
            <button
              type="button"
              class="zoom-menu-item"
              (click)="setZoom(level)"
              [class.active]="zoomLevel() === level"
            >
              {{ level }}%
            </button>
            }
          </div>
          }
        </div>
      </div>
    </div>
    <div class="logo">
      <h1>{{ title() }}</h1>
    </div>
    <div class="toolbar">
      <!-- <button type="button" (click)="undo()" title="Undo">â†¶ Undo</button>
      <button type="button" (click)="redo()" title="Redo">â†· Redo</button>
      <button type="button" (click)="saveProject()" title="Save">ğŸ’¾ Save</button>
      <button type="button" (click)="loadProject()" title="Load">ğŸ“‚ Load</button> -->
      <button type="button" (click)="exportWithTailwind()" title="Export HTML (Tailwind)">
        ğŸ“¥ Export HTML
      </button>
      <!-- <button type="button" (click)="exportPurged()" title="Export Purged (no CDN)">
        ğŸ§¹ Export Purged
      </button> -->
      <button type="button" (click)="exportCss()" title="Export CSS">ğŸ¨ Export CSS</button>
      <button type="button" (click)="preview()" title="Preview (Blob)">ğŸ‘ï¸ Preview</button>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="builder-layout" #layoutRoot>
    <!-- Left Sidebar: Toolbox -->
    <div class="sidebar-left" [style.flex-basis.%]="leftWidth()" [style.max-width.%]="leftWidth()">
      <div class="panel-header">Components</div>
      <div class="panel-content">
        <app-tool-box (addWidget)="dz.add($event, { append: true })"></app-tool-box>
      </div>
    </div>

    <!-- Center: Canvas -->
    <div
      class="canvas-area"
      [style.flex-basis.%]="centerWidth()"
      [style.max-width.%]="centerWidth()"
    >
      <div class="panel-header">Canvas</div>
      <div
        class="canvas-content"
        [style.transform]="'scale(' + zoomLevel() / 100 + ')'"
        [style.transform-origin]="'top left'"
        (wheel)="onCanvasWheel($event)"
      >
        <app-dynamic-zone
          #dz
          [registry]="registry"
          [componentDefinitions]="componentDefinitions"
        ></app-dynamic-zone>
      </div>
    </div>

    <!-- Right Sidebar: Panels -->
    <!-- Right resizer between center and right sidebar -->
    <div class="resizer-vertical" (mousedown)="startDragRight($event)"></div>

    <div
      class="sidebar-right"
      [style.flex-basis.%]="rightWidth()"
      [style.max-width.%]="rightWidth()"
    >
      <!-- Panel Tabs -->
      <div class="panel-tabs">
        <button
          class="tab-button"
          [class.active]="activePanel === 'blocks'"
          (click)="setActivePanel('blocks')"
        >
          Blocks
        </button>
        <button
          class="tab-button"
          [class.active]="activePanel === 'navigator'"
          (click)="setActivePanel('navigator')"
        >
          Layers
        </button>
        <button
          class="tab-button"
          [class.active]="activePanel === 'assets'"
          (click)="setActivePanel('assets')"
        >
          Assets
        </button>
        <button
          class="tab-button"
          [class.active]="activePanel === 'properties'"
          (click)="setActivePanel('properties')"
        >
          Properties
        </button>
      </div>

      <!-- Panel Content -->
      <div class="panel-content">
        @if (activePanel === 'blocks') {
        <app-block-manager-panel [blocks]="blocks"></app-block-manager-panel>
        } @if (activePanel === 'navigator') {
        <app-navigator-panel
          [rootComponent]="getRootComponent()"
          (componentSelect)="onNavigatorSelect($event)"
        ></app-navigator-panel>
        } @if (activePanel === 'assets') {
        <builder-assets-panel></builder-assets-panel>
        } @if (activePanel === 'properties') {
        <app-trait-manager-panel></app-trait-manager-panel>
        }
      </div>
    </div>
  </div>
</div>

<router-outlet />
<builder-modal-host />
<builder-drop-indicator />
